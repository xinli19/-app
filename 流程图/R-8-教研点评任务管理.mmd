flowchart TD
    Start([开始]) --> Mode{选择创建模式}
    Mode -->|手动创建及分配模式| Manual
    Mode -->|复用编辑历史记录创建模式| Reuse

    %% 手动创建及分配模式
    subgraph 手动创建及分配模式
        ManualStart([进入创建点评任务列表])
        ManualStart --> S1[搜索学员昵称（支持模糊匹配）]
        S1 --> O1{是否需要查看学员信息与历史点评记录？}
        O1 -->|是| S2[弹窗查看学员信息和历史点评记录]
        O1 -->|否| S3[选中学员昵称，创建任务]
        S2 --> S3
        S3 --> S4[填写任务备注（可选）]
        S4 --> S5{是否继续添加下一位学员？}
        S5 -->|是| S1
        S5 -->|否| S6[选择点评任务负责教师]
        S6 --> S7[点击保存，分配记录进入“待发送分配任务列表”]
        S7 --> NoteManual1[[规则：待发送分配任务列表中的记录仍可修改/删除]]
        S7 --> S8{是否还需要创建其他任务？}
        S8 -->|是| S1
        S8 -->|否| S9[确认分配]
        S9 --> S10[所有待发送分配任务入库]
        S10 --> S11[清空待发送分配任务列表]
        S11 --> End1([结束])

        NoteManual2[[规则：由教研添加的点评任务来源为“教研”]]
        NoteManual3[[规则：自动创建“分配批次ID”，关联一次分配中同一位教师的多个任务]]
    end

    %% 复用编辑历史记录创建模式
    subgraph 复用编辑历史记录创建模式
        ReuseStart([查看最近的历史任务分配记录])
        ReuseStart --> R1[按时间排序展示历史记录]
        R1 --> R2[以“教师/次”为集合（后台查询分配批次ID）]
        R2 --> R3[呈现字段：任务创建时间、任务负责教师、学员昵称、任务备注]
        R3 --> R4[选择一条历史任务分配记录]
        R4 --> R5[点击“编辑复用”，进入复用修改页面]
        R5 --> R6[编辑可复用任务，丢弃本次不需要的任务]
        R6 --> R7[点击“复用”]
        R7 --> R8[负责教师/学员/任务备注导入“创建点评任务列表”，新的任务创建完成]
        R8 --> EndReuse([返回手动创建及分配模式的后续流程])
    end

    %% 模式间衔接
    Manual --> ManualStart
    Reuse --> ReuseStart
    EndReuse --> S6

    %% 教研删除任务
    subgraph 教研删除任务
        D0([查看最近的历史任务分配记录])
        D0 --> D1[点击某条历史任务分配记录]
        D1 --> D2[进入记录详情/列表]
        D2 --> D3[点击“删除任务”]
        D3 --> D4[权限：教研有权删除所有的任务]
        D4 --> D5[更新数据库]
        D5 --> D6([完成])
    end

    %% 导出本次分配结果
    subgraph 导出本次分配结果
        E0([导出本次分配结果])
        E0 --> E1[选择筛选条件：点评任务负责教师、分配时间]
        E1 --> E2[生成 xlsx 文件]
        E2 --> E3([下载/保存])
    end